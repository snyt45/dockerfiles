" ----------------------------------------------------------------------------
" VIM SETTINGS
" ----------------------------------------------------------------------------

" Display {{{

" ç”»é¢å·¦ç«¯ã«è¡Œç•ªå·ã‚’è¡¨ç¤º
set number
" ç”»é¢å·¦ç«¯ã«ã‚µã‚¤ãƒ³åˆ—ã‚’å¸¸ã«è¡¨ç¤º
set signcolumn=yes
" ç”»é¢æœ€ä¸‹éƒ¨ã«å¸¸ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤º
set laststatus=2
" ç”»é¢æœ€ä¸‹éƒ¨(ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡Œã‚ˆã‚Šä¸‹)ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ¬„ã‚’2è¡Œã«ã™ã‚‹
set cmdheight=2

" ã‚¿ãƒ–æ¯ã«å¸¸ã«ã‚¿ãƒ–ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤º
set showtabline=2

" Vimã®ã‚«ãƒ¼ã‚½ãƒ«è¡¨ç¤º
" ref: https://qiita.com/Linda_pp/items/9e0c94eb82b18071db34
if has('vim_starting')
    " æŒ¿å…¥ãƒ¢ãƒ¼ãƒ‰æ™‚ã«éç‚¹æ»…ã®ç¸¦æ£’ã‚¿ã‚¤ãƒ—ã®ã‚«ãƒ¼ã‚½ãƒ«
    let &t_SI .= "\e[6 q"
    " ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰æ™‚ã«éç‚¹æ»…ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã®ã‚«ãƒ¼ã‚½ãƒ«
    let &t_EI .= "\e[2 q"
    " ç½®æ›ãƒ¢ãƒ¼ãƒ‰æ™‚ã«éç‚¹æ»…ã®ä¸‹ç·šã‚¿ã‚¤ãƒ—ã®ã‚«ãƒ¼ã‚½ãƒ«
    let &t_SR .= "\e[4 q"
endif

" }}}

" Edit {{{

" çŸ©å½¢é¸æŠæ™‚ã«ä»®æƒ³ç·¨é›†ã‚’æœ‰åŠ¹åŒ–
set virtualedit=block

" ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§TABè£œå®Œæ™‚ã«å€™è£œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
set wildmenu wildoptions=pum
" ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§TABè£œå®Œæ™‚ã«å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
set wildignorecase

" ã‚¿ãƒ–ã€ç©ºç™½ã‚’å¯è¦–åŒ–
" set list
" set listchars=tab:Â»-,extends:Â»,precedes:Â«

" ã‚¿ãƒ–ã‚’2æ–‡å­—åˆ†ã«ã™ã‚‹
set tabstop=2
" ã‚¿ãƒ–ã®ä»£ã‚ã‚Šã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨
set expandtab
" ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’åŠè§’ã‚¹ãƒšãƒ¼ã‚¹2æ–‡å­—ã«ã™ã‚‹
set shiftwidth=2
" æ–°ã—ã„è¡Œè¿½åŠ æ™‚ã«è‡ªå‹•ã§ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’è¿½åŠ 
set smartindent

" åŒã˜ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’æŠ˜ã‚Šç•³ã‚€
set foldmethod=indent
" åˆæœŸè¡¨ç¤ºæ™‚ã«å‹æ‰‹ã«æŠ˜ã‚Šç•³ã¾ã‚Œãªã„ã‚ˆã†ã«æŠ˜ã‚Šç•³ã¿ãƒ¬ãƒ™ãƒ«ã‚’æ·±ã‚ã«è¨­å®š
set foldlevel=100

" }}}

" Serach {{{

" æ–‡å­—åˆ—æ¤œç´¢ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
set hlsearch
" æ–‡å­—åˆ—æ¤œç´¢ã§å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
set ignorecase
" æ–‡å­—åˆ—æ¤œç´¢ã§å¤§æ–‡å­—ã‚’å«ã‚“ã§ã„ãŸã‚‰ignorecaseã‚’ä¸Šæ›¸ãã—ã€å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã™ã‚‹
set smartcase
" ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒ
set incsearch

" }}}

" File {{{

" ã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«(.swp)ã‚’ç”Ÿæˆã—ãªã„
" ã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã«å¤‰æ›´å†…å®¹ã‚’å¾©å¸°ã™ã‚‹éš›ã«ä¾¿åˆ©ã ãŒã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¨ãã«æ¯å›å‡ºã‚‹è¡¨ç¤ºãŒã†ã£ã¨ã†ã—ã„ã®ã§ä½¿ã‚ãªã„
set noswapfile
" ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«(~)ã‚’ç”Ÿæˆã—ãªã„
set nobackup
" undoãƒ•ã‚¡ã‚¤ãƒ«(.un~)ã‚’ç”Ÿæˆã—ãªã„
set noundofile

" }}}

" Other {{{

" Vimå†…éƒ¨ã§ä½¿ã‚ã‚Œã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«utf-8ã«ã™ã‚‹
set encoding=utf-8

" æ›´æ–°æ™‚é–“ã‚’100msã«è¨­å®š
" æ›´æ–°æ™‚é–“ã«ä¾å­˜ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãŸã‚ã®è¨­å®š vim-nitgutter etc..
set updatetime=100

" ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹ã«ã™ã‚‹
set mouse=a

" }}}

" ----------------------------------------------------------------------------
" VIM KEY MAPPINGS
" ----------------------------------------------------------------------------

" <Leader>ã«ã‚¹ãƒšãƒ¼ã‚¹å‰²ã‚Šå½“ã¦
let mapleader = "\<Space>"

" Move {{{

" æ®µè½ç§»å‹•
nnoremap <C-j> 5j
nnoremap <C-k> 5k

" }}}

" Edit {{{

" ãƒ¤ãƒ³ã‚¯ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ä½¿ã£ã¦è²¼ã‚Šä»˜ã‘
noremap PP "0p

" ã‚«ãƒ¬ãƒ³ãƒˆãƒãƒƒãƒ•ã‚¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
nnoremap <Leader><C-g> :<C-u>echo "copied fullpath: " . expand('%:p') \| let @"=expand('%:p') \| call system('clip.sh -i', @")<CR>
" ãƒ¤ãƒ³ã‚¯ã—ãŸå†…å®¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
augroup Yank
  au!
  autocmd TextYankPost * :call system('clip.sh -i', @")
augroup END

" }}}

" Tab {{{

" æ–°è¦ã‚¿ãƒ–
nmap te :<C-u>tabedit<CR>
" ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡ã‚’æ–°è¦ã‚¿ãƒ–ã§é–‹ã
nmap tt :<C-u>tab split<CR>
" å‰ã®ã‚¿ãƒ–ã«ç§»å‹•
nmap <S-Tab> :<C-u>tabprev<CR>
" æ¬¡ã®ã‚¿ãƒ–ã«ç§»å‹•
nmap <Tab> :<C-u>tabnext<CR>
" ã‚¿ãƒ–ã‚’å³ã«ç§»å‹•
nmap tn <C-w>:+tabmove<CR>
" ã‚¿ãƒ–ã‚’å·¦ã«ç§»å‹•
nmap tp <C-w>:-tabmove<CR>

" }}}

" Serach {{{

" æ–‡å­—åˆ—æ¤œç´¢ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚ªãƒ•
nnoremap <silent> <Esc><Esc> :<C-u>nohlsearch<CR><Esc>

" }}}

" Quickfix {{{

" æ¬¡ã®çµæœã¸
nnoremap gn :<C-u>cn<CR>
" æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®çµæœã¸
nnoremap gN :<C-u>cnf<CR>
" å‰ã®çµæœã¸
nnoremap gp :<C-u>cp<CR>
" å‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®çµæœã¸
nnoremap gP :<C-u>cpf<CR>
" Toggle quickfix
if exists('g:__QUICKFIX_TOGGLE__')
    finish
endif
let g:__QUICKFIX_TOGGLE__ = 1

function! ToggleQuickfix()
    let l:nr = winnr('$')
    cwindow
    let l:nr2 = winnr('$')
    if l:nr == l:nr2
        cclose
    endif
endfunction
nnoremap <script> <silent> <Leader>qq :call ToggleQuickfix()<CR>

" }}}


" Other {{{

" ã‚ˆããƒŸã‚¹ã‚¿ã‚¤ãƒ—ã™ã‚‹ã®ã§ãƒã‚¯ãƒ­è¨˜éŒ²ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
noremap q <silent>

" }}}

" ----------------------------------------------------------------------------
" PLUGINS
" ----------------------------------------------------------------------------

call plug#begin('~/.shared_cache/.vim/plugged')

" Basic {{{

" ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ
Plug 'morhetz/gruvbox'

" Vimã®ãƒ˜ãƒ«ãƒ—ã‚’æ—¥æœ¬èªåŒ–
Plug 'vim-jp/vimdoc-ja'

" ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ãƒ»ã‚¿ãƒ–ãƒ©ã‚¤ãƒ³
Plug 'itchyny/lightline.vim'
Plug 'shinchu/lightline-gruvbox.vim'

" ç”»é¢å·¦ç«¯ã®ã‚µã‚¤ãƒ³åˆ—ã«git diffãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
Plug 'airblade/vim-gitgutter'

" jkã§ã®ç§»å‹•ã‚’é«˜é€Ÿã«ã™ã‚‹
Plug 'rhysd/accelerated-jk'

" Vimã§fzfã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'

" ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼
Plug 'lambdalisue/nerdfont.vim' " Windowså´ã«nerdfontã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹å¿…è¦ã‚ã‚Š
Plug 'lambdalisue/fern.vim'
Plug 'lambdalisue/fern-renderer-nerdfont.vim' " ãƒ•ã‚¡ã‚¤ãƒ«æ¨ªã«ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
Plug 'lambdalisue/fern-git-status.vim' " ãƒ•ã‚¡ã‚¤ãƒ«æ¨ªã«Gitã®çŠ¶æ…‹è¡¨ç¤º

" ãƒ•ãƒ­ãƒ¼ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã
Plug 'voldikss/vim-floaterm'

" ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’èª¿ã¹ã‚‹
Plug 'rhysd/git-messenger.vim' " default key <leader>gm

" ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
Plug 'tomtom/tcomment_vim'

" quickfixã§ã®æ¤œç´¢ã¨ç½®æ›ã‚’ä¾¿åˆ©ã«ã™ã‚‹
Plug 'wincent/ferret'

" }}}

" Require denops.vim {{{

Plug 'vim-denops/denops.vim'

" é¸æŠç¯„å›²ã‚’ç¿»è¨³
Plug 'skanehira/denops-translate.vim'

" }}}

" Coding Support {{{

" å¯¾å¿œã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã®ãƒšã‚¢ã®è­˜åˆ¥ã‚’å¼·åŒ–
Plug 'andymass/vim-matchup'

" Railsé–‹ç™ºã‚’ä¾¿åˆ©ã«ã™ã‚‹
Plug 'tpope/vim-rails'

" }}}

" Markdown {{{

" ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®ãƒ†ã‚­ã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«è¡¨è¨˜ã«å¤‰æ›
Plug 'mattn/vim-maketable'

" }}}

" LSP {{{

Plug 'prabirshrestha/vim-lsp'
Plug 'mattn/vim-lsp-settings' " å„language-serverã‚’1ã‚³ãƒãƒ³ãƒ‰ã§å°å…¥ã§ãã‚‹
Plug 'tsuyoshicho/vim-efm-langserver-settings' " efm-langserverã‚’ã‚¼ãƒ­ã‚³ãƒ³ãƒ•ã‚£ã‚°ã§ä½¿ãˆã‚‹
Plug 'prabirshrestha/asyncomplete.vim' " éåŒæœŸã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ
Plug 'prabirshrestha/asyncomplete-lsp.vim' " asyncomplete.vimã®source

" }}}

call plug#end()

augroup vimrc_vim_plug_install
  autocmd!

  " è¶³ã‚Šãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚Œã° :PlugInstall ã‚’å®Ÿè¡Œ
  autocmd VimEnter * if len(filter(values(g:plugs), '!isdirectory(v:val.dir)'))
    \| PlugInstall --sync | source $MYVIMRC
  \| endif
augroup END

" ----------------------------------------------------------------------------
" PLUGIN SETTINGS
" ----------------------------------------------------------------------------
" colorscheme {{{

" colorschemeãŒdarkã‚°ãƒ«ãƒ¼ãƒ—ã®é…è‰²ã‚’ä½¿ã†ã‚ˆã†ã«æŒ‡å®š
set background=dark
colorscheme gruvbox

" }}}

" vimdoc-ja {{{

set helplang=ja,en

" }}}

" lightline.vim {{{

if !has('gui_running')
  set t_Co=256
endif

let g:lightline = {}
let g:lightline.colorscheme = 'gruvbox'

" }}}

" vim-gitgutter {{{

let g:gitgutter_sign_added = '+'
let g:gitgutter_sign_modified = '>'
let g:gitgutter_sign_removed = '-'
let g:gitgutter_sign_removed_first_line = '^'
let g:gitgutter_sign_modified_removed = '<'

" ref: https://teratail.com/questions/29844#reply-46767
augroup vimrc_vim_gitgutter
  autocmd!
  " colorschemeèª­ã¿è¾¼ã¿å¾Œã€ã‚µã‚¤ãƒ³åˆ—ã®èƒŒæ™¯è‰²ã‚’NONEã«ã™ã‚‹ â€»Windows Terminalå´ã®è‰²ã‚’ä½¿ã„ãŸã„ãŸã‚
  autocmd VimEnter,ColorScheme * highlight SignColumn guibg=NONE ctermbg=NONE

  " colorschemeèª­ã¿è¾¼ã¿å¾Œã€ã‚µã‚¤ãƒ³åˆ—ã®è¨˜å·ã®è‰²ã‚’è¨­å®š
  autocmd VimEnter,ColorScheme * highlight GitGutterAdd guibg=NONE ctermbg=NONE guifg=#000900 ctermfg=2
  autocmd VimEnter,ColorScheme * highlight GitGutterChange guibg=NONE ctermbg=NONE guifg=#bbbb00 ctermfg=3
  autocmd VimEnter,ColorScheme * highlight GitGutterDelete guibg=NONE ctermbg=NONE guifg=#ff2222 ctermfg=1
augroup END

" }}}

" fzf.vim {{{

" fzfã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä¸‹éƒ¨ã«è¡¨ç¤º
" Ctrl + / ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡æ›¿
let g:fzf_preview_window = ['down:60%', 'ctrl-/']

" }}}

" fern.vim {{{

" éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
let g:fern#default_hidden=1
let g:fern#renderer='nerdfont'

" Vimèµ·å‹•æ™‚ã«fernã‚’é–‹ã
" augroup vimrc_fern
"   autocmd!
"   autocmd VimEnter * ++nested Fern . -drawer -stay -keep -toggle -reveal=%
" augroup END

" }}}

" git-messenger.vim {{{

" ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’å¸¸ã«è¡¨ç¤º
let g:git_messenger_always_into_popup = 1

" }}}

" vim-lsp {{{

" ç”»é¢å·¦ç«¯ã®ã‚µã‚¤ãƒ³åˆ—ã«ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€æƒ…å ±ã€ãƒ’ãƒ³ãƒˆã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
let g:lsp_diagnostics_signs_enabled = 1
let g:lsp_diagnostics_signs_error = {'text': 'ğŸ‘¾'}
let g:lsp_diagnostics_signs_warning = {'text': 'ğŸ’£ï¸'}
let g:lsp_diagnostics_signs_hint = {'text': 'ğŸ’¡'}
let g:lsp_diagnostics_signs_information = {'text': 'â„¹ï¸'}

" Diagnosticsã‚’æœ‰åŠ¹ã«ã™ã‚‹
let g:lsp_diagnostics_enabled = 1
" ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€æƒ…å ±ã€ãƒ’ãƒ³ãƒˆã‚’ç”»é¢ä¸‹éƒ¨ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã«è¡¨ç¤º
let g:lsp_diagnostics_echo_cursor = 1
" ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€æƒ…å ±ã€ãƒ’ãƒ³ãƒˆã‚’ãƒ•ãƒ­ãƒ¼ãƒˆè¡¨ç¤º
let g:lsp_diagnostics_float_cursor = 1

" ç”»é¢å·¦ç«¯ã®ã‚µã‚¤ãƒ³åˆ—ã«ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³éè¡¨ç¤º
let g:lsp_document_code_action_signs_enabled = 0
" let g:lsp_document_code_action_signs_hint = {'text': 'ğŸ…°ï¸'}

let g:lsp_diagnostics_echo_delay = 50
let g:lsp_diagnostics_highlights_delay = 50
let g:lsp_diagnostics_highlights_insert_mode_enabled = 0
let g:lsp_diagnostics_signs_delay = 50
let g:lsp_diagnostics_signs_insert_mode_enabled = 0

" vim-lsp ãŒãƒãƒƒãƒ•ã‚¡ã§æœ‰åŠ¹ã«ãªã£ãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°
" ãƒãƒƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®š
" See: https://mattn.kaoriya.net/software/vim/20191231213507.htm
function! s:on_lsp_buffer_enabled() abort
  let g:lsp_format_sync_timeout = 1000

  " golang {{{

  " ãƒãƒƒãƒ•ã‚¡ä¿å­˜æ™‚ã«æ¯å›ã€Œimportè£œå®Œã€ã¨ã€Œã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚’å®Ÿè¡Œ
  autocmd BufWritePre *.go call execute(['LspCodeActionSync source.organizeImports', 'LspDocumentFormatSync'])

  " }}}
endfunction
augroup lsp_install
  au!
  autocmd User lsp_buffer_enabled call s:on_lsp_buffer_enabled()
augroup END

" debug
" ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹
" let g:lsp_log_verbose = 1
" ãƒ­ã‚°ã®å‡ºåŠ›å…ˆ
" let g:lsp_log_file = expand('~/.shared_cache/.vim/vim-lsp.log')

" }}}

" efm-langserver {{{

let g:lsp_settings_servers_dir='~/.shared_cache/.vim/servers'

" efm-langserverãŒæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
function! s:check_install_efm_langserver()
  if !filereadable(expand(g:lsp_settings_servers_dir . '/efm-langserver/efm-langserver'))
    LspInstallServer efm-langserver
  endif
endfunction

augroup vimrc_check_install_efm_langserver
    autocmd!
    autocmd User lsp_setup call s:check_install_efm_langserver()
augroup END

" https://github.com/nakatanakatana/dotfiles
" for efm-langserver-settings
let s:efm_args = []
if efm_langserver_settings#config_enable()
  let s:efm_args = extend(s:efm_args, ['-c', efm_langserver_settings#config_path()])
endif

if efm_langserver_settings#debug_enable()
  let s:efm_args = extend(s:efm_args, ['-logfile', efm_langserver_settings#debug_path()])
  let s:efm_args = extend(s:efm_args, ['-loglevel', efm_langserver_settings#debug_enable()])
endif

let g:lsp_settings = {
  \ 'efm-langserver': {
    \ 'disabled': v:false,
    \ 'args': s:efm_args,
    \ 'allowlist': efm_langserver_settings#whitelist(),
    \ 'blocklist': efm_langserver_settings#blacklist(),
    \ }
  \ }

" debug
" ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹
" let g:efm_langserver_settings#debug = 5
" ãƒ­ã‚°ã®å‡ºåŠ›å…ˆ
" let g:efm_langserver_settings#debug_file = expand('~/.shared_cache/.vim/efm-langserver.log')

" }}}

" asyncomplete.vim {{{

let g:asyncomplete_popup_delay = 100

" }}}

" ----------------------------------------------------------------------------
" PLUGIN KEY MAPPINGS
" ----------------------------------------------------------------------------

" accelerated-jk {{{

" jkã§ã®ç§»å‹•ã‚’ã‚¿ã‚¤ãƒ—æ•°ã«å¿œã˜ã¦åŠ é€Ÿã™ã‚‹
nmap j <Plug>(accelerated_jk_gj)
nmap k <Plug>(accelerated_jk_gk)

" }}}

" fzf.vim {{{

" fzfã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®gitç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
command! -bang -nargs=? GFilesCwd
  \ call fzf#vim#gitfiles(<q-args>, fzf#vim#with_preview(<q-args> == '?' ? { 'dir': getcwd(), 'placeholder': '' } : { 'dir': getcwd() }), <bang>0)

" fzfã§vimã®ã‚³ãƒãƒ³ãƒ‰å±¥æ­´æ¤œç´¢
nnoremap <silent> <Leader>r :History:!<CR>
" fzfã§gitç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
nnoremap <silent> <Leader>p :GFilesCwd!<CR>
" fzfã§å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
nnoremap <silent> <Leader>g :GFiles!?<CR>
" fzfã§å…¨æ–‡æ¤œç´¢
nnoremap <silent> <Leader>f :Rg!<CR>
" fzfã§ãƒãƒƒãƒ•ã‚¡æ¤œç´¢
nnoremap <silent> <Leader>b :Buffers!<CR>
" fzfã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œæ¤œç´¢
nnoremap <silent> <Leader>l :BLines!<CR>
" fzfã§ãƒ•ã‚¡ã‚¤ãƒ«å±¥æ­´æ¤œç´¢
nnoremap <silent> <Leader>h :History!<CR>
" fzfã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ¤œç´¢
nnoremap <silent> <Leader>w :Windows!<CR>

" }}}

" fern.vim {{{

" fernã‚’é–‹ã
nnoremap <Leader>e :<C-u>Fern . -drawer -stay -keep -toggle -reveal=%<CR>

" }}}

" vim-floaterm {{{

" lazygitã‚’é–‹ã
nnoremap <silent> <Leader>lz :FloatermNew --autoclose=2 --height=0.9 --width=0.9 lazygit<CR>
" ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã
nnoremap <silent> <Leader>lt :FloatermNew --autoclose=2 --height=0.9 --width=0.9<CR>

" "}}}

" vim-lsp {{{

" é©ç”¨ã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒªã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
nnoremap <silent> Q :<C-u>LspCodeAction<CR>
xnoremap <silent> Q :<C-u>'<,'>LspCodeAction<CR>

" å®šç¾©ç®‡æ‰€ã«ç§»å‹•
nnoremap <silent> gd :<C-u>LspDefinition<CR>
" å‚ç…§ç®‡æ‰€ã‚’æ¤œç´¢
nnoremap <silent> gr :<C-u>LspReferences<CR>
" å…¨å®Ÿè£…ã¨interfaceã‚’æ¤œç´¢
nnoremap <silent> gi :<C-u>LspImplementation<CR>
" å‹å®šç¾©ã«ç§»å‹•
nnoremap <silent> gt :<C-u>LspTypeDefinition<CR>
" ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®ã‚·ãƒ³ãƒœãƒ«ã®åå‰ã‚’å¤‰æ›´
nnoremap <silent> grn :LspRename<CR>
" ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®ã‚·ãƒ³ãƒœãƒ«ã®æƒ…å ±ã‚’ãƒ•ãƒ­ãƒ¼ãƒˆè¡¨ç¤º
nnoremap <silent> K :LspHover<CR>

" ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨ºæ–­çµæœã‚’quickfixã«è¡¨ç¤º
nnoremap <silent> gdd :<C-u>LspDocumentDiagnostics<CR>
" ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€æƒ…å ±ã€ãƒ’ãƒ³ãƒˆã‚’å«ã‚€æ¬¡ã®è¨ºæ–­ã«ã‚¸ãƒ£ãƒ³ãƒ—
nnoremap <silent> ]g :LspNextDiagnostic<CR>
" ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€æƒ…å ±ã€ãƒ’ãƒ³ãƒˆã‚’å«ã‚€å‰ã®è¨ºæ–­ã«ã‚¸ãƒ£ãƒ³ãƒ—
nnoremap <silent> [g :LspPreviousDiagnostic<CR>
" æ¬¡ã®ã‚¨ãƒ©ãƒ¼ã«ã‚¸ãƒ£ãƒ³ãƒ—
nnoremap <silent> ]e :LspNextError<CR>
" å‰ã®ã‚¨ãƒ©ãƒ¼ã«ã‚¸ãƒ£ãƒ³ãƒ—
nnoremap <silent> [e :LspPreviousError<CR>

" }}}

" asyncomplete.vim {{{

inoremap <expr> <Tab>   pumvisible() ? "\<C-n>" : "\<Tab>"
inoremap <expr> <S-Tab> pumvisible() ? "\<C-p>" : "\<S-Tab>"
inoremap <expr> <cr>    pumvisible() ? asyncomplete#close_popup() : "\<cr>"

" }}}

" ----------------------------------------------------------------------------
" DOC
" ----------------------------------------------------------------------------

" Fold {{{

" zc åŒã˜ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã‚’æŠ˜ã‚Šç•³ã‚€
" zo æŠ˜ã‚Šç•³ã¿ã‚’å±•é–‹
" zR ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã®æŠ˜ã‚Šç•³ã¿ã‚’å±•é–‹

" }}}

" vim-gitgutter {{{

" :h gitgutter-mappings

" ]c æ¬¡ã®ãƒãƒ³ã‚¯ã«ã‚¸ãƒ£ãƒ³ãƒ—
" [c å‰ã®ãƒãƒ³ã‚¯ã«ã‚¸ãƒ£ãƒ³ãƒ—
" <Leader>hs ãƒãƒ³ã‚¯ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸
" <Leader>hu ãƒãƒ³ã‚¯ã‚’ã‚¢ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸
" <Leader>hp ãƒãƒ³ã‚¯ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

" }}}

" denops-translate.vim {{{

" :Translate é¸æŠè¡Œã‚’ç¿»è¨³

" }}}

" vim-maketable {{{

" ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®ãƒ†ã‚­ã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«è¡¨è¨˜ã«å¤‰æ›

" :MakeTable é¸æŠè¡Œã‚’ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨è¨˜ã«å¤‰æ›
" :MakeTable! é¸æŠè¡Œã®1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨è¨˜ã«å¤‰æ›
" :UnmakeTable ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨è¨˜ã‚’è§£é™¤

" }}}

" vim-rails {{{

" :A å¯¾å¿œã™ã‚‹Specãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
" gf ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®æ–‡å­—åˆ—ã«å¯¾å¿œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã

" "}}}

" fern.vim {{{

" ? fernã®ãƒ˜ãƒ«ãƒ—ã‚’é–‹ã
" C-h è¦ªã®ãƒ•ã‚©ãƒ«ãƒ€ã«æˆ»ã‚‹
" - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
" C-j C-k ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
" ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é¸æŠã—ã¦-ã§ä¸€æ‹¬ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
" s ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é¸æŠ
" S-e é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²è¡¨ç¤º
" S-d é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚´ãƒŸç®±ã¸ â€»trash-cliãŒå¿…è¦
" S-r é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒãƒ¼ãƒ 
" S-c é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
" S-p é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒšãƒ¼ã‚¹ãƒˆ
" S-m ç§»å‹•ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ç§»å‹•ã•ã›ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦S-pã§ç§»å‹•
" S-k ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
" S-n ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
" ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯actionã®cdã‚’å®Ÿè¡Œã™ã‚‹ã€‚GFilesCwd ã®æ¤œç´¢ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªã‚‹ã®ã§ä¾¿åˆ©ã€‚

" }}}

" ferret {{{

" :Ack pattern   ç¾åœ¨ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã‚’æ¤œç´¢
" :Ack pattern % ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
" :Back pattern  ãƒãƒƒãƒ•ã‚¡ä¸€è¦§ã‚’æ¤œç´¢
" :Acks /ç½®æ›å‰/ç½®æ›å¾Œ/ quickfixå†…ã®æ–‡å­—åˆ—ã‚’ç½®æ›ã™ã‚‹
" ferretã§è¿½åŠ ã•ã‚Œã‚‹ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
"   SPC - a :Ack ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ãªã‚‹
"   SPC - s ã‚«ãƒ¼ã‚½ãƒ«ä¸‹ã®æ–‡å­—åˆ—ã‚’:Ackã™ã‚‹
"   SPC - r ç½®æ›ã™ã‚‹ â€»ä½¿ã‚ãªã„ã®ã§ç¾åœ¨ã¯fzf.vimã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸Šæ›¸ã
" quickfixå†…ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
"   dd quickfixã®çµæœã‹ã‚‰è¡Œå‰Šé™¤
"   d  ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§quickfixã®çµæœã‹ã‚‰è¡Œå‰Šé™¤

" }}}

" efm-langserver {{{

" Lintãƒ„ãƒ¼ãƒ«ãŒlanguage-serverã«ãªã‚‹ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§Lintã®çµæœã‚’å—ã‘ãªãŒã‚‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãã‚‹
" efm-langserverã®è¨­å®šã¯vim-efm-langserver-settingsä»»ã›ã§ã‚¼ãƒ­ã‚³ãƒ³ãƒ•ã‚£ã‚°
" Lintãƒ„ãƒ¼ãƒ«ã¨configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸‹è¨˜ã‚’å‚è€ƒã«ç”¨æ„ã™ã‚‹
" ref: https://github.com/tsuyoshicho/vim-efm-langserver-settings#support-command

" }}}

" vim-floaterm {{{

" ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ¢ãƒ¼ãƒ‰æ™‚ã«ä½¿ã†ã‚³ãƒãƒ³ãƒ‰
"   C-w : ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ(ä¾‹ï¼šC-s : ã®å¾Œã« FloatermKill!)
"   C-w N ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ

" }}}
